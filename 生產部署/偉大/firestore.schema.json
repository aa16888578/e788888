{
  "collections": {
    "users": {
      "description": "用戶資料集合",
      "fields": {
        "id": "string (auto-generated)",
        "telegramId": "number (required, unique)",
        "username": "string (optional)",
        "firstName": "string (required)",
        "lastName": "string (optional)",
        "languageCode": "string (optional)",
        "role": "string (enum: admin, user, moderator, default: user)",
        "status": "string (enum: active, inactive, suspended, default: active)",
        "permissions": "array<string> (default: [])",
        "lastLogin": "timestamp",
        "createdAt": "timestamp (auto)",
        "updatedAt": "timestamp (auto)"
      },
      "indexes": [
        "telegramId (ascending)",
        "role (ascending)",
        "status (ascending)",
        "createdAt (descending)"
      ]
    },
    "products": {
      "description": "商品資料集合",
      "fields": {
        "id": "string (auto-generated)",
        "name": "string (required)",
        "description": "string (required)",
        "category": "string (required)",
        "subcategory": "string (optional)",
        "price": "number (required, min: 0)",
        "originalPrice": "number (optional)",
        "currency": "string (default: USDT)",
        "stock": "number (required, min: 0)",
        "images": "array<string> (required, min: 1)",
        "tags": "array<string> (optional)",
        "status": "string (enum: active, inactive, deleted, default: active)",
        "featured": "boolean (default: false)",
        "sortOrder": "number (default: 0)",
        "createdAt": "timestamp (auto)",
        "updatedAt": "timestamp (auto)"
      },
      "indexes": [
        "category (ascending)",
        "status (ascending)",
        "featured (descending)",
        "price (ascending)",
        "createdAt (descending)"
      ]
    },
    "orders": {
      "description": "訂單資料集合",
      "fields": {
        "id": "string (auto-generated)",
        "orderNumber": "string (required, unique)",
        "userId": "string (required, reference: users.id)",
        "telegramId": "number (required)",
        "products": "array<OrderProduct> (required)",
        "subtotal": "number (required, min: 0)",
        "tax": "number (default: 0)",
        "shipping": "number (default: 0)",
        "total": "number (required, min: 0)",
        "currency": "string (default: USDT)",
        "status": "string (enum: pending, processing, shipped, delivered, cancelled, default: pending)",
        "paymentStatus": "string (enum: pending, paid, failed, refunded, default: pending)",
        "paymentMethod": "string (enum: usdt_trc20, usdt_erc20, trx, default: usdt_trc20)",
        "shippingAddress": "object (optional)",
        "notes": "string (optional)",
        "createdAt": "timestamp (auto)",
        "updatedAt": "timestamp (auto)"
      },
      "indexes": [
        "userId (ascending)",
        "telegramId (ascending)",
        "status (ascending)",
        "paymentStatus (ascending)",
        "createdAt (descending)"
      ]
    },
    "orderProducts": {
      "description": "訂單商品詳細資料",
      "fields": {
        "productId": "string (required, reference: products.id)",
        "name": "string (required)",
        "price": "number (required, min: 0)",
        "quantity": "number (required, min: 1)",
        "subtotal": "number (required, min: 0)"
      }
    },
    "payments": {
      "description": "支付記錄集合",
      "fields": {
        "id": "string (auto-generated)",
        "orderId": "string (required, reference: orders.id)",
        "userId": "string (required, reference: users.id)",
        "telegramId": "number (required)",
        "amount": "number (required, min: 0)",
        "currency": "string (default: USDT)",
        "paymentMethod": "string (enum: usdt_trc20, usdt_erc20, trx)",
        "walletAddress": "string (required)",
        "transactionHash": "string (optional)",
        "confirmations": "number (default: 0)",
        "requiredConfirmations": "number (default: 20)",
        "status": "string (enum: pending, processing, confirmed, failed, expired, refunded)",
        "expiresAt": "timestamp (required)",
        "paidAt": "timestamp (optional)",
        "createdAt": "timestamp (auto)",
        "updatedAt": "timestamp (auto)"
      },
      "indexes": [
        "orderId (ascending)",
        "userId (ascending)",
        "status (ascending)",
        "createdAt (descending)"
      ]
    },
    "categories": {
      "description": "商品分類集合",
      "fields": {
        "id": "string (auto-generated)",
        "name": "string (required)",
        "description": "string (optional)",
        "parentId": "string (optional, reference: categories.id)",
        "image": "string (optional)",
        "sortOrder": "number (default: 0)",
        "status": "string (enum: active, inactive, default: active)",
        "createdAt": "timestamp (auto)",
        "updatedAt": "timestamp (auto)"
      },
      "indexes": [
        "parentId (ascending)",
        "status (ascending)",
        "sortOrder (ascending)"
      ]
    },
    "sessions": {
      "description": "用戶會話集合",
      "fields": {
        "id": "string (auto-generated)",
        "telegramId": "number (required)",
        "sessionToken": "string (required, unique)",
        "expiresAt": "timestamp (required)",
        "lastActivity": "timestamp (auto)",
        "createdAt": "timestamp (auto)"
      },
      "indexes": [
        "telegramId (ascending)",
        "sessionToken (ascending)",
        "expiresAt (ascending)"
      ]
    }
  },
  "securityRules": {
    "users": {
      "read": "request.auth != null && (resource.data.telegramId == request.auth.token.telegram_id || request.auth.token.role == 'admin')",
      "write": "request.auth != null && (resource.data.telegramId == request.auth.token.telegram_id || request.auth.token.role == 'admin')"
    },
    "products": {
      "read": "true",
      "write": "request.auth != null && request.auth.token.role in ['admin', 'moderator']"
    },
    "orders": {
      "read": "request.auth != null && (resource.data.telegramId == request.auth.token.telegram_id || request.auth.token.role in ['admin', 'moderator'])",
      "write": "request.auth != null && (resource.data.telegramId == request.auth.token.telegram_id || request.auth.token.role in ['admin', 'moderator'])"
    },
    "payments": {
      "read": "request.auth != null && (resource.data.telegramId == request.auth.token.telegram_id || request.auth.token.role in ['admin', 'moderator'])",
      "write": "request.auth != null && (resource.data.telegramId == request.auth.token.telegram_id || request.auth.token.role in ['admin', 'moderator'])"
    },
    "categories": {
      "read": "true",
      "write": "request.auth != null && request.auth.token.role in ['admin', 'moderator']"
    },
    "sessions": {
      "read": "request.auth != null && resource.data.telegramId == request.auth.token.telegram_id",
      "write": "request.auth != null && resource.data.telegramId == request.auth.token.telegram_id"
    }
  }
}
