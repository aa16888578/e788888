{"fsPath":"/home/a0928997578_gmail_com/å‰å¤§/scripts/dev.sh","fileUuid":"e4406e86-e750-4b7f-9d2b-8fa16b1057b0","fileSizeBytes":5899,"numLines":280,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":281,"addedLines":["#!/bin/bash","","# ========================================","# ShopBot å¤šå¹³å°é›»å•†ç³»çµ± - çµ±ä¸€é–‹ç™¼è…³æœ¬","# ========================================","","set -e  # é‡åˆ°éŒ¯èª¤æ™‚é€€å‡º","","# é¡è‰²å®šç¾©","RED='\\033[0;31m'","GREEN='\\033[0;32m'","YELLOW='\\033[1;33m'","BLUE='\\033[0;34m'","PURPLE='\\033[0;35m'","CYAN='\\033[0;36m'","NC='\\033[0m' # No Color","","# æ—¥èªŒå‡½æ•¸","log_info() {","    echo -e \"${BLUE}[INFO]${NC} $1\"","}","","log_success() {","    echo -e \"${GREEN}[SUCCESS]${NC} $1\"","}","","log_warning() {","    echo -e \"${YELLOW}[WARNING]${NC} $1\"","}","","log_error() {","    echo -e \"${RED}[ERROR]${NC} $1\"","}","","log_service() {","    echo -e \"${PURPLE}[SERVICE]${NC} $1\"","}","","# æª¢æŸ¥ç’°å¢ƒ","check_environment() {","    log_info \"æª¢æŸ¥é–‹ç™¼ç’°å¢ƒ...\"","    ","    # æª¢æŸ¥ Node.js","    if ! command -v node &> /dev/null; then","        log_error \"Node.js æœªå®‰è£ï¼Œè«‹å…ˆå®‰è£ Node.js 18+\"","        exit 1","    fi","    ","    # æª¢æŸ¥ npm","    if ! command -v npm &> /dev/null; then","        log_error \"npm æœªå®‰è£ï¼Œè«‹å…ˆå®‰è£ npm 8+\"","        exit 1","    fi","    ","    # æª¢æŸ¥ç’°å¢ƒé…ç½®æ–‡ä»¶","    if [ ! -f \".env.local\" ] && [ ! -f \".env\" ]; then","        log_warning \"æœªæ‰¾åˆ°ç’°å¢ƒé…ç½®æ–‡ä»¶ï¼Œè«‹å…ˆé…ç½® .env.local\"","        log_info \"å¯ä»¥è¤‡è£½ .env.example ç‚º .env.local ä¸¦å¡«å…¥å¯¦éš›å€¼\"","    fi","    ","    log_success \"ç’°å¢ƒæª¢æŸ¥å®Œæˆ\"","}","","# æª¢æŸ¥ä¾è³´","check_dependencies() {","    log_info \"æª¢æŸ¥é …ç›®ä¾è³´...\"","    ","    local missing_deps=false","    ","    # æª¢æŸ¥ç®¡ç†å¾Œå°ä¾è³´","    if [ -d \"admin\" ] && [ ! -d \"admin/node_modules\" ]; then","        log_warning \"ç®¡ç†å¾Œå°ä¾è³´æœªå®‰è£\"","        missing_deps=true","    fi","    ","    # æª¢æŸ¥ MiniWeb ä¾è³´","    if [ -d \"web\" ] && [ ! -d \"web/node_modules\" ]; then","        log_warning \"MiniWeb ä¾è³´æœªå®‰è£\"","        missing_deps=true","    fi","    ","    # æª¢æŸ¥å¾Œç«¯æœå‹™ä¾è³´","    if [ -d \"functions\" ] && [ ! -d \"functions/node_modules\" ]; then","        log_warning \"å¾Œç«¯æœå‹™ä¾è³´æœªå®‰è£\"","        missing_deps=true","    fi","    ","    if [ \"$missing_deps\" = true ]; then","        log_info \"æ­£åœ¨å®‰è£ç¼ºå¤±çš„ä¾è³´...\"","        npm run install:all","    fi","    ","    log_success \"ä¾è³´æª¢æŸ¥å®Œæˆ\"","}","","# å•Ÿå‹•ç®¡ç†å¾Œå°","start_admin() {","    log_service \"å•Ÿå‹•ç®¡ç†å¾Œå°...\"","    ","    if [ -d \"admin\" ] && [ -f \"admin/package.json\" ]; then","        cd admin","        ","        # æª¢æŸ¥æ˜¯å¦æœ‰é–‹ç™¼è…³æœ¬","        if npm run | grep -q \"dev\"; then","            # åœ¨å¾Œå°å•Ÿå‹•ç®¡ç†å¾Œå°","            nohup npm run dev > ../logs/admin.log 2>&1 &","            ADMIN_PID=$!","            echo $ADMIN_PID > ../logs/admin.pid","            log_success \"ç®¡ç†å¾Œå°å·²å•Ÿå‹• (PID: $ADMIN_PID, ç«¯å£: 3001)\"","        else","            log_warning \"ç®¡ç†å¾Œå°æ²’æœ‰é–‹ç™¼è…³æœ¬ï¼Œè·³é\"","        fi","        ","        cd ..","    else","        log_warning \"ç®¡ç†å¾Œå°ç›®éŒ„ä¸å­˜åœ¨ï¼Œè·³é\"","    fi","}","","# å•Ÿå‹• MiniWeb","start_web() {","    log_service \"å•Ÿå‹• MiniWeb...\"","    ","    if [ -d \"web\" ] && [ -f \"web/package.json\" ]; then","        cd web","        ","        # æª¢æŸ¥æ˜¯å¦æœ‰é–‹ç™¼è…³æœ¬","        if npm run | grep -q \"dev\"; then","            # åœ¨å¾Œå°å•Ÿå‹• MiniWeb","            nohup npm run dev > ../logs/web.log 2>&1 &","            WEB_PID=$!","            echo $WEB_PID > ../logs/web.pid","            log_success \"MiniWeb å·²å•Ÿå‹• (PID: $WEB_PID, ç«¯å£: 3002)\"","        else","            log_warning \"MiniWeb æ²’æœ‰é–‹ç™¼è…³æœ¬ï¼Œè·³é\"","        fi","        ","        cd ..","    else","        log_warning \"MiniWeb ç›®éŒ„ä¸å­˜åœ¨ï¼Œè·³é\"","    fi","}","","# å•Ÿå‹•å¾Œç«¯æœå‹™","start_functions() {","    log_service \"å•Ÿå‹•å¾Œç«¯æœå‹™...\"","    ","    if [ -d \"functions\" ] && [ -f \"functions/package.json\" ]; then","        cd functions","        ","        # æª¢æŸ¥æ˜¯å¦æœ‰é–‹ç™¼è…³æœ¬","        if npm run | grep -q \"dev\"; then","            # åœ¨å¾Œå°å•Ÿå‹•å¾Œç«¯æœå‹™","            nohup npm run dev > ../logs/functions.log 2>&1 &","            FUNCTIONS_PID=$!","            echo $FUNCTIONS_PID > ../logs/functions.pid","            log_success \"å¾Œç«¯æœå‹™å·²å•Ÿå‹• (PID: $FUNCTIONS_PID, ç«¯å£: 5001)\"","        else","            log_warning \"å¾Œç«¯æœå‹™æ²’æœ‰é–‹ç™¼è…³æœ¬ï¼Œè·³é\"","        fi","        ","        cd ..","    else","        log_warning \"å¾Œç«¯æœå‹™ç›®éŒ„ä¸å­˜åœ¨ï¼Œè·³é\"","    fi","}","","# å‰µå»ºæ—¥èªŒç›®éŒ„","create_logs_directory() {","    if [ ! -d \"logs\" ]; then","        mkdir -p logs","        log_info \"å‰µå»ºæ—¥èªŒç›®éŒ„: logs/\"","    fi","}","","# é¡¯ç¤ºæœå‹™ç‹€æ…‹","show_service_status() {","    echo \"\"","    echo \"========================================\"","    echo \"ğŸš€ é–‹ç™¼æœå‹™å•Ÿå‹•å®Œæˆï¼\"","    echo \"========================================\"","    echo \"\"","    echo \"ğŸ“± æœå‹™åœ°å€ï¼š\"","    echo \"   â€¢ ç®¡ç†å¾Œå°: http://localhost:3001\"","    echo \"   â€¢ MiniWeb:   http://localhost:3002\"","    echo \"   â€¢ å¾Œç«¯æœå‹™:  http://localhost:5001\"","    echo \"\"","    echo \"ğŸ“‹ æ—¥èªŒæ–‡ä»¶ï¼š\"","    echo \"   â€¢ ç®¡ç†å¾Œå°: logs/admin.log\"","    echo \"   â€¢ MiniWeb:   logs/web.log\"","    echo \"   â€¢ å¾Œç«¯æœå‹™:  logs/functions.log\"","    echo \"\"","    echo \"ğŸ›‘ åœæ­¢æœå‹™ï¼š\"","    echo \"   â€¢ åœæ­¢æ‰€æœ‰: npm run stop\"","    echo \"   â€¢ æŸ¥çœ‹é€²ç¨‹: npm run status\"","    echo \"\"","    echo \"ğŸ’¡ æç¤ºï¼š\"","    echo \"   â€¢ æŒ‰ Ctrl+C åœæ­¢æ‰€æœ‰æœå‹™\"","    echo \"   â€¢ æŸ¥çœ‹æ—¥èªŒ: tail -f logs/*.log\"","    echo \"   â€¢ é‡å•Ÿæœå‹™: npm run restart\"","    echo \"\"","}","","# æ¸…ç†å‡½æ•¸","cleanup() {","    log_info \"æ­£åœ¨åœæ­¢æ‰€æœ‰æœå‹™...\"","    ","    # åœæ­¢ç®¡ç†å¾Œå°","    if [ -f \"logs/admin.pid\" ]; then","        ADMIN_PID=$(cat logs/admin.pid)","        if kill -0 $ADMIN_PID 2>/dev/null; then","            kill $ADMIN_PID","            log_info \"å·²åœæ­¢ç®¡ç†å¾Œå° (PID: $ADMIN_PID)\"","        fi","        rm -f logs/admin.pid","    fi","    ","    # åœæ­¢ MiniWeb","    if [ -f \"logs/web.pid\" ]; then","        WEB_PID=$(cat logs/web.pid)","        if kill -0 $WEB_PID 2>/dev/null; then","            kill $WEB_PID","            log_info \"å·²åœæ­¢ MiniWeb (PID: $WEB_PID)\"","        fi","        rm -f logs/web.pid","    fi","    ","    # åœæ­¢å¾Œç«¯æœå‹™","    if [ -f \"logs/functions.pid\" ]; then","        FUNCTIONS_PID=$(cat logs/functions.pid)","        if kill -0 $FUNCTIONS_PID 2>/dev/null; then","            kill $FUNCTIONS_PID","            log_info \"å·²åœæ­¢å¾Œç«¯æœå‹™ (PID: $FUNCTIONS_PID)\"","        fi","        rm -f logs/functions.pid","    fi","    ","    log_success \"æ‰€æœ‰æœå‹™å·²åœæ­¢\"","    exit 0","}","","# è¨­ç½®ä¿¡è™Ÿè™•ç†","trap cleanup SIGINT SIGTERM","","# ä¸»å‡½æ•¸","main() {","    echo \"========================================\"","    echo \"ğŸš€ ShopBot å¤šå¹³å°é›»å•†ç³»çµ± - é–‹ç™¼æ¨¡å¼\"","    echo \"========================================\"","    echo \"\"","    ","    # æª¢æŸ¥ç’°å¢ƒ","    check_environment","    ","    # æª¢æŸ¥ä¾è³´","    check_dependencies","    ","    # å‰µå»ºæ—¥èªŒç›®éŒ„","    create_logs_directory","    ","    # å•Ÿå‹•å„å€‹æœå‹™","    start_admin","    start_web","    start_functions","    ","    # é¡¯ç¤ºæœå‹™ç‹€æ…‹","    show_service_status","    ","    # ç­‰å¾…ç”¨æˆ¶ä¸­æ–·","    log_info \"æ‰€æœ‰æœå‹™æ­£åœ¨é‹è¡Œä¸­... æŒ‰ Ctrl+C åœæ­¢\"","    ","    # ä¿æŒè…³æœ¬é‹è¡Œ","    while true; do","        sleep 1","    done","}","","# åŸ·è¡Œä¸»å‡½æ•¸","main \"$@\"",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000002,1000001,1000004,1000001,1000005,1000006,1000007,1000008,1000009,1000010,1000011,1000012,1000001,1000013,1000014,1000015,1000016,1000001,1000017,1000018,1000016,1000001,1000019,1000020,1000016,1000001,1000021,1000022,1000016,1000001,1000023,1000024,1000016,1000001,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000028,1000034,1000035,1000036,1000032,1000033,1000028,1000037,1000038,1000039,1000040,1000033,1000028,1000041,1000016,1000001,1000042,1000043,1000044,1000028,1000045,1000028,1000046,1000047,1000048,1000049,1000033,1000028,1000050,1000051,1000052,1000049,1000033,1000028,1000053,1000054,1000055,1000049,1000033,1000028,1000056,1000057,1000058,1000033,1000028,1000059,1000016,1000001,1000060,1000061,1000062,1000028,1000063,1000064,1000065,1000066,1000067,1000068,1000069,1000070,1000071,1000072,1000073,1000074,1000075,1000065,1000076,1000077,1000078,1000033,1000016,1000001,1000079,1000080,1000081,1000028,1000082,1000083,1000065,1000066,1000067,1000084,1000085,1000086,1000087,1000088,1000073,1000089,1000075,1000065,1000076,1000077,1000090,1000033,1000016,1000001,1000091,1000092,1000093,1000028,1000094,1000095,1000065,1000066,1000067,1000096,1000097,1000098,1000099,1000100,1000073,1000101,1000075,1000065,1000076,1000077,1000102,1000033,1000016,1000001,1000103,1000104,1000105,1000106,1000107,1000033,1000016,1000001,1000108,1000109,1000110,1000111,1000112,1000111,1000110,1000113,1000114,1000115,1000116,1000110,1000117,1000118,1000119,1000120,1000110,1000121,1000122,1000123,1000110,1000124,1000125,1000126,1000127,1000110,1000016,1000001,1000128,1000129,1000130,1000028,1000131,1000132,1000133,1000134,1000135,1000136,1000075,1000137,1000033,1000028,1000138,1000139,1000140,1000141,1000142,1000143,1000075,1000144,1000033,1000028,1000145,1000146,1000147,1000148,1000149,1000150,1000075,1000151,1000033,1000028,1000152,1000153,1000016,1000001,1000154,1000155,1000001,1000156,1000157,1000111,1000158,1000111,1000110,1000028,1000159,1000160,1000028,1000161,1000162,1000028,1000163,1000164,1000028,1000165,1000166,1000167,1000168,1000028,1000169,1000170,1000028,1000171,1000172,1000028,1000173,1000174,1000175,1000176,1000016,1000001,1000177,1000178,1000001]}],"gitInfo":{"gitInfo":{"gitRoot":"/home/a0928997578_gmail_com"}},"kind":"KIND_ADDED"}