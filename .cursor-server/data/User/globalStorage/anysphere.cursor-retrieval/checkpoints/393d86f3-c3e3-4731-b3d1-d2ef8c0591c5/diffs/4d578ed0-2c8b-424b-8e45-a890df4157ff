{"fsPath":"/home/a0928997578_gmail_com/偉大/scripts/build.sh","fileUuid":"4d578ed0-2c8b-424b-8e45-a890df4157ff","fileSizeBytes":6616,"numLines":337,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":338,"addedLines":["#!/bin/bash","","# ========================================","# ShopBot 多平台電商系統 - 統一構建腳本","# ========================================","","set -e  # 遇到錯誤時退出","","# 顏色定義","RED='\\033[0;31m'","GREEN='\\033[0;32m'","YELLOW='\\033[1;33m'","BLUE='\\033[0;34m'","NC='\\033[0m' # No Color","","# 日誌函數","log_info() {","    echo -e \"${BLUE}[INFO]${NC} $1\"","}","","log_success() {","    echo -e \"${GREEN}[SUCCESS]${NC} $1\"","}","","log_warning() {","    echo -e \"${YELLOW}[WARNING]${NC} $1\"","}","","log_error() {","    echo -e \"${RED}[ERROR]${NC} $1\"","}","","# 檢查 Node.js 版本","check_node_version() {","    log_info \"檢查 Node.js 版本...\"","    ","    if ! command -v node &> /dev/null; then","        log_error \"Node.js 未安裝，請先安裝 Node.js 18+\"","        exit 1","    fi","    ","    NODE_VERSION=$(node -v | cut -d'v' -f2)","    NODE_MAJOR=$(echo $NODE_VERSION | cut -d'.' -f1)","    ","    if [ \"$NODE_MAJOR\" -lt 18 ]; then","        log_error \"Node.js 版本過低，需要 18+，當前版本: $NODE_VERSION\"","        exit 1","    fi","    ","    log_success \"Node.js 版本檢查通過: $NODE_VERSION\"","}","","# 檢查 npm 版本","check_npm_version() {","    log_info \"檢查 npm 版本...\"","    ","    if ! command -v npm &> /dev/null; then","        log_error \"npm 未安裝，請先安裝 npm 8+\"","        exit 1","    fi","    ","    NPM_VERSION=$(npm -v)","    NPM_MAJOR=$(echo $NPM_VERSION | cut -d'.' -f1)","    ","    if [ \"$NPM_MAJOR\" -lt 8 ]; then","        log_error \"npm 版本過低，需要 8+，當前版本: $NPM_VERSION\"","        exit 1","    fi","    ","    log_success \"npm 版本檢查通過: $NPM_VERSION\"","}","","# 清理構建文件","clean_build_files() {","    log_info \"清理構建文件...\"","    ","    # 清理管理後台","    if [ -d \"admin/.next\" ]; then","        rm -rf admin/.next","        log_info \"已清理 admin/.next\"","    fi","    ","    if [ -d \"admin/out\" ]; then","        rm -rf admin/out","        log_info \"已清理 admin/out\"","    fi","    ","    if [ -d \"admin/dist\" ]; then","        rm -rf admin/dist","        log_info \"已清理 admin/dist\"","    fi","    ","    # 清理 MiniWeb","    if [ -d \"web/.next\" ]; then","        rm -rf web/.next","        log_info \"已清理 web/.next\"","    fi","    ","    if [ -d \"web/out\" ]; then","        rm -rf web/out","        log_info \"已清理 web/out\"","    fi","    ","    if [ -d \"web/dist\" ]; then","        rm -rf web/dist","        log_info \"已清理 web/dist\"","    fi","    ","    # 清理後端服務","    if [ -d \"functions/dist\" ]; then","        rm -rf functions/dist","        log_info \"已清理 functions/dist\"","    fi","    ","    log_success \"構建文件清理完成\"","}","","# 安裝依賴","install_dependencies() {","    log_info \"安裝項目依賴...\"","    ","    # 安裝根目錄依賴","    if [ -f \"package.json\" ]; then","        log_info \"安裝根目錄依賴...\"","        npm install","    fi","    ","    # 安裝管理後台依賴","    if [ -d \"admin\" ] && [ -f \"admin/package.json\" ]; then","        log_info \"安裝管理後台依賴...\"","        cd admin","        npm install","        cd ..","    fi","    ","    # 安裝 MiniWeb 依賴","    if [ -d \"web\" ] && [ -f \"web/package.json\" ]; then","        log_info \"安裝 MiniWeb 依賴...\"","        cd web","        npm install","        cd ..","    fi","    ","    # 安裝後端服務依賴","    if [ -d \"functions\" ] && [ -f \"functions/package.json\" ]; then","        log_info \"安裝後端服務依賴...\"","        cd functions","        npm install","        cd ..","    fi","    ","    log_success \"所有依賴安裝完成\"","}","","# 構建管理後台","build_admin() {","    log_info \"構建管理後台...\"","    ","    if [ -d \"admin\" ] && [ -f \"admin/package.json\" ]; then","        cd admin","        ","        # 檢查是否有構建腳本","        if npm run | grep -q \"build\"; then","            npm run build","            log_success \"管理後台構建完成\"","        else","            log_warning \"管理後台沒有構建腳本，跳過\"","        fi","        ","        cd ..","    else","        log_warning \"管理後台目錄不存在，跳過\"","    fi","}","","# 構建 MiniWeb","build_web() {","    log_info \"構建 MiniWeb...\"","    ","    if [ -d \"web\" ] && [ -f \"web/package.json\" ]; then","        cd web","        ","        # 檢查是否有構建腳本","        if npm run | grep -q \"build\"; then","            npm run build","            log_success \"MiniWeb 構建完成\"","        else","            log_warning \"MiniWeb 沒有構建腳本，跳過\"","        fi","        ","        cd ..","    else","        log_warning \"MiniWeb 目錄不存在，跳過\"","    fi","}","","# 構建後端服務","build_functions() {","    log_info \"構建後端服務...\"","    ","    if [ -d \"functions\" ] && [ -f \"functions/package.json\" ]; then","        cd functions","        ","        # 檢查是否有構建腳本","        if npm run | grep -q \"build\"; then","            npm run build","            log_success \"後端服務構建完成\"","        else","            log_warning \"後端服務沒有構建腳本，跳過\"","        fi","        ","        cd ..","    else","        log_warning \"後端服務目錄不存在，跳過\"","    fi","}","","# 檢查構建結果","check_build_results() {","    log_info \"檢查構建結果...\"","    ","    local build_success=true","    ","    # 檢查管理後台","    if [ -d \"admin\" ]; then","        if [ -d \"admin/.next\" ] || [ -d \"admin/out\" ] || [ -d \"admin/dist\" ]; then","            log_success \"管理後台構建成功\"","        else","            log_warning \"管理後台構建可能失敗\"","            build_success=false","        fi","    fi","    ","    # 檢查 MiniWeb","    if [ -d \"web\" ]; then","        if [ -d \"web/.next\" ] || [ -d \"web/out\" ] || [ -d \"web/dist\" ]; then","            log_success \"MiniWeb 構建成功\"","        else","            log_warning \"MiniWeb 構建可能失敗\"","            build_success=false","        fi","    fi","    ","    # 檢查後端服務","    if [ -d \"functions\" ]; then","        if [ -d \"functions/dist\" ]; then","            log_success \"後端服務構建成功\"","        else","            log_warning \"後端服務構建可能失敗\"","            build_success=false","        fi","    fi","    ","    if [ \"$build_success\" = true ]; then","        log_success \"所有項目構建完成！\"","    else","        log_warning \"部分項目構建可能失敗，請檢查日誌\"","    fi","}","","# 顯示構建信息","show_build_info() {","    echo \"\"","    echo \"========================================\"","    echo \"🏗️  構建完成！\"","    echo \"========================================\"","    echo \"\"","    echo \"📁 構建輸出目錄：\"","    ","    if [ -d \"admin/.next\" ]; then","        echo \"   • 管理後台: admin/.next/\"","    fi","    ","    if [ -d \"admin/out\" ]; then","        echo \"   • 管理後台: admin/out/\"","    fi","    ","    if [ -d \"admin/dist\" ]; then","        echo \"   • 管理後台: admin/dist/\"","    fi","    ","    if [ -d \"web/.next\" ]; then","        echo \"   • MiniWeb: web/.next/\"","    fi","    ","    if [ -d \"web/out\" ]; then","        echo \"   • MiniWeb: web/out/\"","    fi","    ","    if [ -d \"web/dist\" ]; then","        echo \"   • MiniWeb: web/dist/\"","    fi","    ","    if [ -d \"functions/dist\" ]; then","        echo \"   • 後端服務: functions/dist/\"","    fi","    ","    echo \"\"","    echo \"🚀 下一步：\"","    echo \"   • 開發模式: npm run dev\"","    echo \"   • 部署: npm run deploy\"","    echo \"   • 清理: npm run clean\"","    echo \"\"","}","","# 主函數","main() {","    echo \"========================================\"","    echo \"🚀 ShopBot 多平台電商系統 - 統一構建\"","    echo \"========================================\"","    echo \"\"","    ","    # 檢查環境","    check_node_version","    check_npm_version","    ","    # 清理舊的構建文件","    clean_build_files","    ","    # 安裝依賴","    install_dependencies","    ","    # 構建各個項目","    build_admin","    build_web","    build_functions","    ","    # 檢查構建結果","    check_build_results","    ","    # 顯示構建信息","    show_build_info","}","","# 執行主函數","main \"$@\"",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000002,1000001,1000004,1000001,1000005,1000006,1000007,1000008,1000009,1000010,1000001,1000011,1000012,1000013,1000014,1000001,1000015,1000016,1000014,1000001,1000017,1000018,1000014,1000001,1000019,1000020,1000014,1000001,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000024,1000029,1000030,1000024,1000031,1000032,1000027,1000028,1000024,1000033,1000014,1000001,1000034,1000035,1000036,1000024,1000037,1000038,1000027,1000028,1000024,1000039,1000040,1000024,1000041,1000042,1000027,1000028,1000024,1000043,1000014,1000001,1000044,1000045,1000046,1000024,1000047,1000048,1000049,1000050,1000028,1000024,1000051,1000052,1000053,1000028,1000024,1000054,1000055,1000056,1000028,1000024,1000057,1000058,1000059,1000060,1000028,1000024,1000061,1000062,1000063,1000028,1000024,1000064,1000065,1000066,1000028,1000024,1000067,1000068,1000069,1000070,1000028,1000024,1000071,1000014,1000001,1000072,1000073,1000074,1000024,1000075,1000076,1000077,1000078,1000028,1000024,1000079,1000080,1000081,1000082,1000078,1000083,1000028,1000024,1000084,1000085,1000086,1000087,1000078,1000083,1000028,1000024,1000088,1000089,1000090,1000091,1000078,1000083,1000028,1000024,1000092,1000014,1000001,1000093,1000094,1000095,1000024,1000080,1000082,1000096,1000097,1000098,1000099,1000100,1000101,1000102,1000103,1000096,1000083,1000104,1000105,1000028,1000014,1000001,1000106,1000107,1000108,1000024,1000085,1000087,1000096,1000097,1000098,1000099,1000109,1000101,1000110,1000103,1000096,1000083,1000104,1000111,1000028,1000014,1000001,1000112,1000113,1000114,1000024,1000089,1000091,1000096,1000097,1000098,1000099,1000115,1000101,1000116,1000103,1000096,1000083,1000104,1000117,1000028,1000014,1000001,1000118,1000119,1000120,1000024,1000121,1000024,1000122,1000123,1000124,1000125,1000101,1000126,1000127,1000103,1000028,1000024,1000128,1000129,1000130,1000131,1000101,1000132,1000127,1000103,1000028,1000024,1000133,1000134,1000135,1000136,1000101,1000137,1000127,1000103,1000028,1000024,1000138,1000139,1000104,1000140,1000028,1000014,1000001,1000141,1000142,1000143,1000144,1000145,1000144,1000143,1000146,1000024,1000048,1000147,1000028,1000024,1000051,1000148,1000028,1000024,1000054,1000149,1000028,1000024,1000058,1000150,1000028,1000024,1000061,1000151,1000028,1000024,1000064,1000152,1000028,1000024,1000068,1000153,1000028,1000024,1000143,1000154,1000155,1000156,1000157,1000143,1000014,1000001,1000158,1000159,1000144,1000160,1000144,1000143,1000024,1000161,1000162,1000163,1000024,1000164,1000165,1000024,1000166,1000167,1000024,1000168,1000169,1000170,1000171,1000024,1000172,1000173,1000024,1000174,1000175,1000014,1000001,1000176,1000177,1000001]}],"gitInfo":{"gitInfo":{"gitRoot":"/home/a0928997578_gmail_com"}},"kind":"KIND_ADDED"}