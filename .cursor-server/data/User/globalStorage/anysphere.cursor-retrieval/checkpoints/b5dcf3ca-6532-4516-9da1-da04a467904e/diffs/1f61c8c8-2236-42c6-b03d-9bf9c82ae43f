{"fsPath":"/home/a0928997578_gmail_com/偉大/admin/src/hooks/useData.ts","fileUuid":"1f61c8c8-2236-42c6-b03d-9bf9c82ae43f","fileSizeBytes":8203,"numLines":353,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":354,"addedLines":["import { useState, useEffect, useCallback } from 'react';","import { ","  userService, ","  productService, ","  orderService, ","  agentService, ","  paymentService ","} from '@/lib/database';","import { ","  User, ","  Product, ","  Order, ","  Agent, ","  Payment, ","  PaginationParams, ","  PaginatedResponse,","  ProductFilters,","  OrderFilters","} from '@/types';","","// 用戶數據 Hook","export function useUsers(pagination?: PaginationParams) {","  const [users, setUsers] = useState<User[]>([]);","  const [loading, setLoading] = useState(false);","  const [error, setError] = useState<string | null>(null);","","  const fetchUsers = useCallback(async () => {","    try {","      setLoading(true);","      setError(null);","      const data = await userService.getAll();","      setUsers(data);","    } catch (err) {","      setError(err instanceof Error ? err.message : '獲取用戶失敗');","    } finally {","      setLoading(false);","    }","  }, []);","","  useEffect(() => {","    fetchUsers();","  }, [fetchUsers]);","","  const updateUser = async (id: string, data: Partial<User>) => {","    try {","      await userService.update(id, data);","      await fetchUsers(); // 重新獲取數據","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '更新用戶失敗');","      return false;","    }","  };","","  const deleteUser = async (id: string) => {","    try {","      await userService.delete(id);","      await fetchUsers(); // 重新獲取數據","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '刪除用戶失敗');","      return false;","    }","  };","","  return {","    users,","    loading,","    error,","    fetchUsers,","    updateUser,","    deleteUser,","  };","}","","// 商品數據 Hook","export function useProducts(filters?: ProductFilters) {","  const [products, setProducts] = useState<Product[]>([]);","  const [loading, setLoading] = useState(false);","  const [error, setError] = useState<string | null>(null);","","  const fetchProducts = useCallback(async () => {","    try {","      setLoading(true);","      setError(null);","      let data: Product[];","      if (filters) {","        data = await productService.searchProducts(filters);","      } else {","        data = await productService.getAll();","      }","      setProducts(data);","    } catch (err) {","      setError(err instanceof Error ? err.message : '獲取商品失敗');","    } finally {","      setLoading(false);","    }","  }, [filters]);","","  useEffect(() => {","    fetchProducts();","  }, [fetchProducts]);","","  const createProduct = async (data: Omit<Product, 'id'>) => {","    try {","      await productService.create(data);","      await fetchProducts();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '創建商品失敗');","      return false;","    }","  };","","  const updateProduct = async (id: string, data: Partial<Product>) => {","    try {","      await productService.update(id, data);","      await fetchProducts();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '更新商品失敗');","      return false;","    }","  };","","  const deleteProduct = async (id: string) => {","    try {","      await productService.delete(id);","      await fetchProducts();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '刪除商品失敗');","      return false;","    }","  };","","  return {","    products,","    loading,","    error,","    fetchProducts,","    createProduct,","    updateProduct,","    deleteProduct,","  };","}","","// 訂單數據 Hook","export function useOrders(filters?: OrderFilters) {","  const [orders, setOrders] = useState<Order[]>([]);","  const [loading, setLoading] = useState(false);","  const [error, setError] = useState<string | null>(null);","","  const fetchOrders = useCallback(async () => {","    try {","      setLoading(true);","      setError(null);","      let data: Order[];","      if (filters?.status) {","        data = await orderService.getByStatus(filters.status);","      } else {","        data = await orderService.getAll();","      }","      setOrders(data);","    } catch (err) {","      setError(err instanceof Error ? err.message : '獲取訂單失敗');","    } finally {","      setLoading(false);","    }","  }, [filters]);","","  useEffect(() => {","    fetchOrders();","  }, [fetchOrders]);","","  const updateOrderStatus = async (id: string, status: Order['status']) => {","    try {","      await orderService.update(id, { status });","      await fetchOrders();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '更新訂單狀態失敗');","      return false;","    }","  };","","  return {","    orders,","    loading,","    error,","    fetchOrders,","    updateOrderStatus,","  };","}","","// 代理數據 Hook","export function useAgents() {","  const [agents, setAgents] = useState<Agent[]>([]);","  const [loading, setLoading] = useState(false);","  const [error, setError] = useState<string | null>(null);","","  const fetchAgents = useCallback(async () => {","    try {","      setLoading(true);","      setError(null);","      const data = await agentService.getAll();","      setAgents(data);","    } catch (err) {","      setError(err instanceof Error ? err.message : '獲取代理失敗');","    } finally {","      setLoading(false);","    }","  }, []);","","  useEffect(() => {","    fetchAgents();","  }, [fetchAgents]);","","  const createAgent = async (data: Omit<Agent, 'id'>) => {","    try {","      await agentService.create(data);","      await fetchAgents();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '創建代理失敗');","      return false;","    }","  };","","  const updateAgent = async (id: string, data: Partial<Agent>) => {","    try {","      await agentService.update(id, data);","      await fetchAgents();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '更新代理失敗');","      return false;","    }","  };","","  return {","    agents,","    loading,","    error,","    fetchAgents,","    createAgent,","    updateAgent,","  };","}","","// 支付數據 Hook","export function usePayments() {","  const [payments, setPayments] = useState<Payment[]>([]);","  const [loading, setLoading] = useState(false);","  const [error, setError] = useState<string | null>(null);","","  const fetchPayments = useCallback(async () => {","    try {","      setLoading(true);","      setError(null);","      const data = await paymentService.getAll();","      setPayments(data);","    } catch (err) {","      setError(err instanceof Error ? err.message : '獲取支付失敗');","    } finally {","      setLoading(false);","    }","  }, []);","","  useEffect(() => {","    fetchPayments();","  }, [fetchPayments]);","","  const updatePaymentStatus = async (id: string, status: Payment['paymentStatus']) => {","    try {","      await paymentService.update(id, { paymentStatus: status });","      await fetchPayments();","      return true;","    } catch (err) {","      setError(err instanceof Error ? err.message : '更新支付狀態失敗');","      return false;","    }","  };","","  return {","    payments,","    loading,","    error,","    fetchPayments,","    updatePaymentStatus,","  };","}","","// 儀表板數據 Hook","export function useDashboardData() {","  const [metrics, setMetrics] = useState({","    totalUsers: 0,","    totalProducts: 0,","    totalOrders: 0,","    totalRevenue: 0,","    pendingOrders: 0,","    lowStockProducts: 0,","  });","  const [loading, setLoading] = useState(false);","  const [error, setError] = useState<string | null>(null);","","  const fetchDashboardData = useCallback(async () => {","    try {","      setLoading(true);","      setError(null);","      ","      // 並行獲取所有數據","      const [users, products, orders, payments] = await Promise.all([","        userService.getAll(),","        productService.getAll(),","        orderService.getAll(),","        paymentService.getAll(),","      ]);","","      const totalRevenue = payments","        .filter(p => p.paymentStatus === 'confirmed')","        .reduce((sum, p) => sum + p.amount, 0);","","      const pendingOrders = orders.filter(o => o.status === 'pending').length;","      const lowStockProducts = products.filter(p => p.stock <= 10).length;","","      setMetrics({","        totalUsers: users.length,","        totalProducts: products.length,","        totalOrders: orders.length,","        totalRevenue,","        pendingOrders,","        lowStockProducts,","      });","    } catch (err) {","      setError(err instanceof Error ? err.message : '獲取儀表板數據失敗');","    } finally {","      setLoading(false);","    }","  }, []);","","  useEffect(() => {","    fetchDashboardData();","  }, [fetchDashboardData]);","","  return {","    metrics,","    loading,","    error,","    fetchDashboardData,","  };","}",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000007,1000001,1000008,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000018,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000018,1000036,1000037,1000038,1000018,1000039,1000025,1000040,1000041,1000042,1000030,1000043,1000044,1000034,1000045,1000018,1000046,1000025,1000047,1000041,1000042,1000030,1000048,1000044,1000034,1000045,1000018,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000045,1000056,1000018,1000057,1000058,1000059,1000022,1000023,1000018,1000060,1000025,1000026,1000027,1000061,1000062,1000063,1000064,1000065,1000066,1000067,1000030,1000068,1000032,1000033,1000034,1000069,1000018,1000036,1000070,1000071,1000018,1000072,1000025,1000073,1000074,1000042,1000030,1000075,1000044,1000034,1000045,1000018,1000076,1000025,1000077,1000074,1000042,1000030,1000078,1000044,1000034,1000045,1000018,1000079,1000025,1000080,1000074,1000042,1000030,1000081,1000044,1000034,1000045,1000018,1000049,1000082,1000051,1000052,1000083,1000084,1000085,1000086,1000045,1000056,1000018,1000087,1000088,1000089,1000022,1000023,1000018,1000090,1000025,1000026,1000027,1000091,1000092,1000093,1000064,1000094,1000066,1000095,1000030,1000096,1000032,1000033,1000034,1000069,1000018,1000036,1000097,1000098,1000018,1000099,1000025,1000100,1000101,1000042,1000030,1000102,1000044,1000034,1000045,1000018,1000049,1000103,1000051,1000052,1000104,1000105,1000045,1000056,1000018,1000106,1000107,1000108,1000022,1000023,1000018,1000109,1000025,1000026,1000027,1000110,1000111,1000030,1000112,1000032,1000033,1000034,1000035,1000018,1000036,1000113,1000114,1000018,1000115,1000025,1000116,1000117,1000042,1000030,1000118,1000044,1000034,1000045,1000018,1000119,1000025,1000120,1000117,1000042,1000030,1000121,1000044,1000034,1000045,1000018,1000049,1000122,1000051,1000052,1000123,1000124,1000125,1000045,1000056,1000018,1000126,1000127,1000128,1000022,1000023,1000018,1000129,1000025,1000026,1000027,1000130,1000131,1000030,1000132,1000032,1000033,1000034,1000035,1000018,1000036,1000133,1000134,1000018,1000135,1000025,1000136,1000137,1000042,1000030,1000138,1000044,1000034,1000045,1000018,1000049,1000139,1000051,1000052,1000140,1000141,1000045,1000056,1000018,1000142,1000143,1000144,1000145,1000146,1000147,1000148,1000149,1000150,1000151,1000022,1000023,1000018,1000152,1000025,1000026,1000027,1000153,1000154,1000155,1000156,1000157,1000158,1000159,1000160,1000018,1000161,1000162,1000163,1000018,1000164,1000165,1000018,1000166,1000167,1000168,1000169,1000170,1000171,1000172,1000173,1000030,1000174,1000032,1000033,1000034,1000035,1000018,1000036,1000175,1000176,1000018,1000049,1000177,1000051,1000052,1000178,1000045,1000056,1000018]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}