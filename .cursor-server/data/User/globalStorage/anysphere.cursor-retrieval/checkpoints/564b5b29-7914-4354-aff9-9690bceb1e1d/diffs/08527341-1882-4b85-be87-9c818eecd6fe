{"fsPath":"/home/a0928997578_gmail_com/å‰å¤§/functions/src/services/telegram.ts","fileUuid":"08527341-1882-4b85-be87-9c818eecd6fe","fileSizeBytes":33130,"numLines":1170,"diffChanges":[{"originalStartLineNumberOneIndexed":7,"originalEndLineNumberExclusiveOneIndexed":7,"modifiedStartLineNumberOneIndexed":7,"modifiedEndLineNumberExclusiveOneIndexed":8,"addedLines":["import { agentService } from './agent';"],"tokenizedAddedLines":[1000374]},{"originalStartLineNumberOneIndexed":406,"originalEndLineNumberExclusiveOneIndexed":406,"modifiedStartLineNumberOneIndexed":407,"modifiedEndLineNumberExclusiveOneIndexed":415,"addedLines":["      [","        { text: 'ğŸ’³ ç”³è«‹æç¾', callback_data: 'agent_withdrawal' },","        { text: 'ğŸ“ˆ ç¸¾æ•ˆåˆ†æ', callback_data: 'agent_performance' }","      ],","      [","        { text: 'ğŸ”— æ¨è–¦ç¢¼', callback_data: 'agent_referral' },","        { text: 'ğŸ“ è¨»å†Šä»£ç†', callback_data: 'agent_register' }","      ],"],"tokenizedAddedLines":[55,1000375,1000376,58,55,1000377,1000378,58]},{"originalStartLineNumberOneIndexed":507,"originalEndLineNumberExclusiveOneIndexed":507,"modifiedStartLineNumberOneIndexed":516,"modifiedEndLineNumberExclusiveOneIndexed":549,"addedLines":["        // ä»£ç†ç³»çµ±ç›¸é—œå›èª¿","        case 'agent_status':","          await this.handleAgentStatus(from.id);","          break;","          ","        case 'agent_earnings':","          await this.handleAgentEarnings(from.id);","          break;","          ","        case 'agent_team':","          await this.handleAgentTeam(from.id);","          break;","          ","        case 'agent_orders':","          await this.handleAgentOrders(from.id);","          break;","          ","        case 'agent_withdrawal':","          await this.handleAgentWithdrawal(from.id);","          break;","          ","        case 'agent_performance':","          await this.handleAgentPerformance(from.id);","          break;","          ","        case 'agent_referral':","          await this.handleAgentReferral(from.id);","          break;","          ","        case 'agent_register':","          await this.handleAgentRegister(from.id);","          break;","          "],"tokenizedAddedLines":[1000379,1000380,1000381,256,257,1000382,1000383,256,257,1000384,1000385,256,257,1000386,1000387,256,257,1000388,1000389,256,257,1000390,1000391,256,257,1000392,1000393,256,257,1000394,1000395,256,257]},{"originalStartLineNumberOneIndexed":662,"originalEndLineNumberExclusiveOneIndexed":662,"modifiedStartLineNumberOneIndexed":704,"modifiedEndLineNumberExclusiveOneIndexed":1169,"addedLines":["","  // ä»£ç†ç³»çµ±è™•ç†æ–¹æ³•","  ","  // è™•ç†ä»£ç†ç‹€æ…‹æŸ¥è©¢","  static async handleAgentStatus(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      const statusText = `ğŸ“Š <b>ä»£ç†ç‹€æ…‹</b>","","ğŸ‘¤ <b>ä»£ç†ä¿¡æ¯</b>","â€¢ å§“åï¼š${agent.firstName}","â€¢ ç­‰ç´šï¼š${agent.level.icon} ${agent.level.name}","â€¢ ç‹€æ…‹ï¼š${this.getAgentStatusText(agent.status)}","â€¢ æ¨è–¦ç¢¼ï¼š<code>${agent.referralCode}</code>","","ğŸ’° <b>æ”¶ç›Šçµ±è¨ˆ</b>","â€¢ ç¸½éŠ·å”®é¡ï¼š${agent.totalSales.toFixed(2)} USDT","â€¢ ç¸½ä½£é‡‘ï¼š${agent.totalCommission.toFixed(2)} USDT","â€¢ å¯æç¾ï¼š${agent.availableCommission.toFixed(2)} USDT","","ğŸ‘¥ <b>åœ˜éšŠä¿¡æ¯</b>","â€¢ åœ˜éšŠäººæ•¸ï¼š${agent.teamSize} äºº","â€¢ åœ˜éšŠéŠ·å”®ï¼š${agent.teamSales.toFixed(2)} USDT","","ğŸ“… <b>åŠ å…¥æ™‚é–“</b>","â€¢ ${agent.joinDate.toLocaleDateString('zh-TW')}`;","","      const keyboard = [","        [","          { text: 'ğŸ’° æ”¶ç›ŠæŸ¥è©¢', callback_data: 'agent_earnings' },","          { text: 'ğŸ‘¥ åœ˜éšŠç®¡ç†', callback_data: 'agent_team' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, statusText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†ç‹€æ…‹æŸ¥è©¢å¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ ç²å–ä»£ç†ç‹€æ…‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†æ”¶ç›ŠæŸ¥è©¢","  static async handleAgentEarnings(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      const earningsText = `ğŸ’° <b>ä»£ç†æ”¶ç›Š</b>","","ğŸ“Š <b>æ”¶ç›Šæ¦‚è¦½</b>","â€¢ ç¸½éŠ·å”®é¡ï¼š${agent.totalSales.toFixed(2)} USDT","â€¢ ç¸½ä½£é‡‘ï¼š${agent.totalCommission.toFixed(2)} USDT","â€¢ å¯æç¾ï¼š${agent.availableCommission.toFixed(2)} USDT","â€¢ ä½£é‡‘æ¯”ä¾‹ï¼š${agent.commissionRate}%","","ğŸ“ˆ <b>ç­‰ç´šæ¬Šç›Š</b>","â€¢ ç•¶å‰ç­‰ç´šï¼š${agent.level.icon} ${agent.level.name}","â€¢ ç­‰ç´šè¦æ±‚ï¼šéŠ·å”®é¡ ${agent.level.minSales} USDTï¼Œåœ˜éšŠ ${agent.level.minTeamSize} äºº","â€¢ ä¸‹ç´šç­‰ç´šï¼š${this.getNextLevelInfo(agent.level.level)}","","ğŸ’¡ <b>æå‡å»ºè­°</b>","${this.getLevelUpgradeAdvice(agent)}`;","","      const keyboard = [","        [","          { text: 'ğŸ’³ ç”³è«‹æç¾', callback_data: 'agent_withdrawal' },","          { text: 'ğŸ“ˆ ç¸¾æ•ˆåˆ†æ', callback_data: 'agent_performance' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, earningsText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†æ”¶ç›ŠæŸ¥è©¢å¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ ç²å–ä»£ç†æ”¶ç›Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†åœ˜éšŠç®¡ç†","  static async handleAgentTeam(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      const team = await agentService.getAgentTeam(agent.id);","      ","      let teamText = `ğŸ‘¥ <b>åœ˜éšŠç®¡ç†</b>","","ğŸ“Š <b>åœ˜éšŠæ¦‚è¦½</b>","â€¢ åœ˜éšŠäººæ•¸ï¼š${agent.teamSize} äºº","â€¢ åœ˜éšŠéŠ·å”®ï¼š${agent.teamSales.toFixed(2)} USDT","","ğŸ“‹ <b>åœ˜éšŠæˆå“¡</b>`;","","      if (team.length === 0) {","        teamText += '\\nâ€¢ æš«ç„¡åœ˜éšŠæˆå“¡';","      } else {","        team.forEach((member, index) => {","          teamText += `\\n${index + 1}. ${member.memberType === 'direct' ? 'ç›´æ¥' : 'é–“æ¥'}æˆå“¡ (${member.totalSales.toFixed(2)} USDT)`;","        });","      }","","      teamText += `\\n\\nğŸ’¡ <b>åœ˜éšŠå»ºè¨­å»ºè­°</b>","â€¢ ç©æ¥µæ¨è–¦æ–°ä»£ç†åŠ å…¥","â€¢ å¹«åŠ©åœ˜éšŠæˆå“¡æå‡æ¥­ç¸¾","â€¢ å®šæœŸæºé€šå’ŒåŸ¹è¨“`;","","      const keyboard = [","        [","          { text: 'ğŸ”— æ¨è–¦ç¢¼', callback_data: 'agent_referral' },","          { text: 'ğŸ“ˆ ç¸¾æ•ˆåˆ†æ', callback_data: 'agent_performance' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, teamText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†åœ˜éšŠç®¡ç†å¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ ç²å–åœ˜éšŠä¿¡æ¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†è¨‚å–®æŸ¥è©¢","  static async handleAgentOrders(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      const ordersText = `ğŸ“‹ <b>ä»£ç†è¨‚å–®</b>","","ğŸ“Š <b>è¨‚å–®çµ±è¨ˆ</b>","â€¢ ç¸½è¨‚å–®æ•¸ï¼š${agent.totalSales > 0 ? Math.ceil(agent.totalSales / 100) : 0} ç­†","â€¢ å¹³å‡è¨‚å–®é‡‘é¡ï¼š${agent.totalSales > 0 ? (agent.totalSales / Math.ceil(agent.totalSales / 100)).toFixed(2) : 0} USDT","","ğŸ’¡ <b>è¨‚å–®ç®¡ç†</b>","â€¢ é—œæ³¨å®¢æˆ¶è¨‚å–®ç‹€æ…‹","â€¢ åŠæ™‚è™•ç†å”®å¾Œå•é¡Œ","â€¢ æå‡å®¢æˆ¶æ»¿æ„åº¦`;","","      const keyboard = [","        [","          { text: 'ğŸ’° æ”¶ç›ŠæŸ¥è©¢', callback_data: 'agent_earnings' },","          { text: 'ğŸ“ˆ ç¸¾æ•ˆåˆ†æ', callback_data: 'agent_performance' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, ordersText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†è¨‚å–®æŸ¥è©¢å¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ ç²å–è¨‚å–®ä¿¡æ¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†æç¾ç”³è«‹","  static async handleAgentWithdrawal(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      if (agent.availableCommission < 50) {","        await this.sendMessage(chatId, `âŒ å¯æç¾ä½£é‡‘ä¸è¶³ã€‚\\n\\nğŸ’° ç•¶å‰å¯æç¾ï¼š${agent.availableCommission.toFixed(2)} USDT\\nğŸ’³ æœ€ä½æç¾é‡‘é¡ï¼š50 USDT`);","        return;","      }","","      const withdrawalText = `ğŸ’³ <b>ç”³è«‹æç¾</b>","","ğŸ’° <b>æç¾ä¿¡æ¯</b>","â€¢ å¯æç¾ä½£é‡‘ï¼š${agent.availableCommission.toFixed(2)} USDT","â€¢ æœ€ä½æç¾ï¼š50 USDT","â€¢ æ‰‹çºŒè²»ï¼š2%","â€¢ è™•ç†æ™‚é–“ï¼š24å°æ™‚å…§","","ğŸ“ <b>æç¾æµç¨‹</b>","1. è¯ç¹«å®¢æœç”³è«‹æç¾","2. æä¾›éŒ¢åŒ…åœ°å€","3. ç¢ºèªæç¾é‡‘é¡","4. ç­‰å¾…è™•ç†å®Œæˆ","","ğŸ’¡ <b>æ³¨æ„äº‹é …</b>","â€¢ è«‹ç¢ºä¿éŒ¢åŒ…åœ°å€æ­£ç¢º","â€¢ æç¾æ‰‹çºŒè²»å°‡å¾æç¾é‡‘é¡ä¸­æ‰£é™¤","â€¢ å¦‚æœ‰å•é¡Œè«‹è¯ç¹«å®¢æœ`;","","      const keyboard = [","        [","          { text: 'ğŸ“ è¯ç¹«å®¢æœ', callback_data: 'contact_support' },","          { text: 'ğŸ’° æ”¶ç›ŠæŸ¥è©¢', callback_data: 'agent_earnings' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, withdrawalText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†æç¾ç”³è«‹å¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ è™•ç†æç¾ç”³è«‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†ç¸¾æ•ˆåˆ†æ","  static async handleAgentPerformance(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      const performance = await agentService.getAgentPerformance(","        agent.id,","        'monthly',","        new Date(new Date().getFullYear(), new Date().getMonth(), 1),","        new Date()","      );","","      const performanceText = `ğŸ“ˆ <b>ç¸¾æ•ˆåˆ†æ</b>","","ğŸ“Š <b>æœ¬æœˆç¸¾æ•ˆ</b>","â€¢ è¨‚å–®æ•¸é‡ï¼š${performance.totalOrders} ç­†","â€¢ éŠ·å”®é‡‘é¡ï¼š${performance.totalSales.toFixed(2)} USDT","â€¢ ä½£é‡‘æ”¶å…¥ï¼š${performance.totalCommission.toFixed(2)} USDT","â€¢ å¹³å‡è¨‚å–®ï¼š${performance.averageOrderValue.toFixed(2)} USDT","","ğŸ¯ <b>ç›®æ¨™é”æˆ</b>","â€¢ éŠ·å”®ç›®æ¨™ï¼š${this.getSalesTarget(agent.level.level)} USDT","â€¢ å®Œæˆé€²åº¦ï¼š${this.getProgressPercentage(agent.totalSales, this.getSalesTarget(agent.level.level))}%","","ğŸ’¡ <b>æå‡å»ºè­°</b>","${this.getPerformanceAdvice(agent, performance)}`;","","      const keyboard = [","        [","          { text: 'ğŸ’° æ”¶ç›ŠæŸ¥è©¢', callback_data: 'agent_earnings' },","          { text: 'ğŸ‘¥ åœ˜éšŠç®¡ç†', callback_data: 'agent_team' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, performanceText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†ç¸¾æ•ˆåˆ†æå¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ ç²å–ç¸¾æ•ˆåˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†æ¨è–¦ç¢¼","  static async handleAgentReferral(chatId: number) {","    try {","      const agent = await agentService.getAgentByTelegramId(chatId);","      ","      if (!agent) {","        await this.sendMessage(chatId, 'âŒ æ‚¨é‚„ä¸æ˜¯ä»£ç†ï¼Œè«‹å…ˆè¨»å†Šæˆç‚ºä»£ç†ã€‚');","        return;","      }","","      const referralText = `ğŸ”— <b>æ¨è–¦ç¢¼</b>","","ğŸ¯ <b>æ‚¨çš„æ¨è–¦ç¢¼</b>","â€¢ æ¨è–¦ç¢¼ï¼š<code>${agent.referralCode}</code>","â€¢ åˆ†äº«éˆæ¥ï¼šhttps://t.me/your_bot?start=${agent.referralCode}","","ğŸ’° <b>æ¨è–¦çå‹µ</b>","â€¢ æ¨è–¦æ–°ä»£ç†ï¼š10 USDT çé‡‘","â€¢ æ–°ä»£ç†é¦–å–®ï¼šé¡å¤–ä½£é‡‘","â€¢ åœ˜éšŠå»ºè¨­ï¼šé•·æœŸæ”¶ç›Š","","ğŸ“± <b>åˆ†äº«æ–¹å¼</b>","1. è¤‡è£½æ¨è–¦ç¢¼ç™¼é€çµ¦æœ‹å‹","2. åˆ†äº«å°ˆå±¬éˆæ¥","3. åœ¨ç¤¾äº¤åª’é«”å®£å‚³","4. ç·šä¸‹æ¨å»£æ´»å‹•","","ğŸ’¡ <b>æ¨å»£æŠ€å·§</b>","â€¢ çªå‡ºç”¢å“å„ªå‹¢","â€¢ åˆ†äº«æˆåŠŸæ¡ˆä¾‹","â€¢ æä¾›å°ˆæ¥­å»ºè­°","â€¢ å»ºç«‹ä¿¡ä»»é—œä¿‚`;","","      const keyboard = [","        [","          { text: 'ğŸ“‹ è¤‡è£½æ¨è–¦ç¢¼', callback_data: 'copy_referral_code' },","          { text: 'ğŸ”— åˆ†äº«éˆæ¥', callback_data: 'share_referral_link' }","        ],","        [","          { text: 'ğŸ’° æ”¶ç›ŠæŸ¥è©¢', callback_data: 'agent_earnings' },","          { text: 'ğŸ‘¥ åœ˜éšŠç®¡ç†', callback_data: 'agent_team' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, referralText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†æ¨è–¦ç¢¼å¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ ç²å–æ¨è–¦ç¢¼å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è™•ç†ä»£ç†è¨»å†Š","  static async handleAgentRegister(chatId: number) {","    try {","      const existingAgent = await agentService.getAgentByTelegramId(chatId);","      ","      if (existingAgent) {","        await this.sendMessage(chatId, 'âœ… æ‚¨å·²ç¶“æ˜¯ä»£ç†äº†ï¼\\n\\nğŸ“Š æŸ¥çœ‹ä»£ç†ç‹€æ…‹ï¼š/agent_status');","        return;","      }","","      const registerText = `ğŸ“ <b>ä»£ç†è¨»å†Š</b>","","ğŸ¯ <b>æˆç‚ºä»£ç†çš„å¥½è™•</b>","â€¢ éŠ·å”®ä½£é‡‘ï¼š5%-18%","â€¢ åœ˜éšŠçå‹µï¼šé¡å¤–æ”¶ç›Š","â€¢ æ¨è–¦çé‡‘ï¼š10 USDT","â€¢ ç­‰ç´šæ™‰å‡ï¼šæ›´å¤šæ¬Šç›Š","","ğŸ“‹ <b>è¨»å†Šè¦æ±‚</b>","â€¢ å¹´æ»¿18æ­²","â€¢ æœ‰éŠ·å”®ç¶“é©—","â€¢ é¡˜æ„æ¨å»£ç”¢å“","â€¢ éµå®ˆä»£ç†è¦å‰‡","","ğŸ’¡ <b>è¨»å†Šæµç¨‹</b>","1. å¡«å¯«åŸºæœ¬ä¿¡æ¯","2. ç­‰å¾…å¯©æ ¸é€šé","3. é–‹å§‹æ¨å»£éŠ·å”®","4. ç²å¾—ä½£é‡‘æ”¶ç›Š","","ğŸ”— <b>é–‹å§‹è¨»å†Š</b>","è«‹è¯ç¹«å®¢æœé€²è¡Œä»£ç†è¨»å†Šï¼Œæˆ–ä½¿ç”¨æ¨è–¦ç¢¼è¨»å†Šã€‚`;","","      const keyboard = [","        [","          { text: 'ğŸ“ è¯ç¹«å®¢æœ', callback_data: 'contact_support' },","          { text: 'ğŸ”— ä½¿ç”¨æ¨è–¦ç¢¼', callback_data: 'use_referral_code' }","        ],","        [","          { text: 'ğŸ”™ è¿”å›ä»£ç†ç³»çµ±', callback_data: 'agent_system' }","        ]","      ];","","      await this.sendMessageWithKeyboard(chatId, registerText, keyboard);","    } catch (error) {","      console.error('è™•ç†ä»£ç†è¨»å†Šå¤±æ•—:', error);","      await this.sendMessage(chatId, 'âŒ è™•ç†ä»£ç†è¨»å†Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');","    }","  }","","  // è¼”åŠ©æ–¹æ³•","  ","  // ç²å–ä»£ç†ç‹€æ…‹æ–‡æœ¬","  private static getAgentStatusText(status: string): string {","    const statusMap: { [key: string]: string } = {","      'pending': 'å¾…å¯©æ ¸',","      'active': 'æ´»èº',","      'suspended': 'æš«åœ',","      'terminated': 'çµ‚æ­¢',","      'inactive': 'ä¸æ´»èº'","    };","    return statusMap[status] || 'æœªçŸ¥';","  }","","  // ç²å–ä¸‹ç´šç­‰ç´šä¿¡æ¯","  private static getNextLevelInfo(currentLevel: number): string {","    if (currentLevel >= 5) return 'å·²é”æœ€é«˜ç­‰ç´š';","    ","    const nextLevels = [","      'éŠ€ç‰Œä»£ç† (1000 USDT, 5äºº)',","      'é‡‘ç‰Œä»£ç† (5000 USDT, 15äºº)',","      'ç™½é‡‘ä»£ç† (15000 USDT, 30äºº)',","      'é‘½çŸ³ä»£ç† (50000 USDT, 50äºº)'","    ];","    ","    return nextLevels[currentLevel - 1] || 'æœªçŸ¥';","  }","","  // ç²å–ç­‰ç´šå‡ç´šå»ºè­°","  private static getLevelUpgradeAdvice(agent: any): string {","    const currentLevel = agent.level.level;","    const nextLevel = currentLevel + 1;","    ","    if (nextLevel > 5) return 'ğŸ‰ æ­å–œï¼æ‚¨å·²é”åˆ°æœ€é«˜ç­‰ç´šã€‚';","    ","    const nextLevels = [","      { sales: 1000, team: 5 },","      { sales: 5000, team: 15 },","      { sales: 15000, team: 30 },","      { sales: 50000, team: 50 }","    ];","    ","    const target = nextLevels[currentLevel - 1];","    if (!target) return 'ğŸ’¡ ç¹¼çºŒåŠªåŠ›ï¼Œæå‡æ¥­ç¸¾ï¼';","    ","    const salesDiff = target.sales - agent.totalSales;","    const teamDiff = target.team - agent.teamSize;","    ","    let advice = 'ğŸ’¡ å‡ç´šå»ºè­°ï¼š\\n';","    if (salesDiff > 0) advice += `â€¢ å¢åŠ éŠ·å”®é¡ ${salesDiff.toFixed(2)} USDT\\n`;","    if (teamDiff > 0) advice += `â€¢ æ“´å±•åœ˜éšŠ ${teamDiff} äºº\\n`;","    ","    return advice;","  }","","  // ç²å–éŠ·å”®ç›®æ¨™","  private static getSalesTarget(level: number): number {","    const targets = [0, 1000, 5000, 15000, 50000];","    return targets[level] || 0;","  }","","  // ç²å–é€²åº¦ç™¾åˆ†æ¯”","  private static getProgressPercentage(current: number, target: number): string {","    if (target === 0) return '0%';","    const percentage = (current / target) * 100;","    return Math.min(percentage, 100).toFixed(1) + '%';","  }","","  // ç²å–ç¸¾æ•ˆå»ºè­°","  private static getPerformanceAdvice(agent: any, performance: any): string {","    if (performance.totalOrders === 0) {","      return 'ğŸ’¡ æœ¬æœˆé‚„æ²’æœ‰è¨‚å–®ï¼Œå»ºè­°ï¼š\\nâ€¢ ç©æ¥µæ¨å»£ç”¢å“\\nâ€¢ è¯ç¹«æ½›åœ¨å®¢æˆ¶\\nâ€¢ åƒåŠ åŸ¹è¨“æ´»å‹•';","    }","    ","    if (performance.averageOrderValue < 100) {","      return 'ğŸ’¡ å¹³å‡è¨‚å–®é‡‘é¡åä½ï¼Œå»ºè­°ï¼š\\nâ€¢ æ¨è–¦é«˜åƒ¹å€¼ç”¢å“\\nâ€¢ æä¾›çµ„åˆå„ªæƒ \\nâ€¢ æå‡å®¢æˆ¶é«”é©—';","    }","    ","    return 'ğŸ’¡ æ¥­ç¸¾è¡¨ç¾è‰¯å¥½ï¼Œå»ºè­°ï¼š\\nâ€¢ ä¿æŒæ¨å»£åŠ›åº¦\\nâ€¢ æ“´å±•å®¢æˆ¶ç¾¤é«”\\nâ€¢ æå‡æœå‹™è³ªé‡';","  }"],"tokenizedAddedLines":[8,1000396,1000397,1000398,1000399,15,1000400,118,1000401,1000402,1000403,31,8,1000404,8,1000405,1000406,1000407,1000408,1000409,8,1000410,1000411,1000412,1000413,8,1000414,1000415,1000416,8,1000417,1000418,8,119,120,1000419,1000420,123,120,1000421,125,126,8,1000422,33,1000423,1000424,36,37,8,1000425,1000426,15,1000400,118,1000401,1000402,1000403,31,8,1000427,8,1000428,1000411,1000412,1000413,1000429,8,1000430,1000431,1000432,1000433,8,1000434,1000435,8,119,120,1000436,1000437,123,120,1000421,125,126,8,1000438,33,1000439,1000440,36,37,8,1000441,1000442,15,1000400,118,1000401,1000402,1000403,31,8,1000443,118,1000444,8,1000445,1000415,1000416,8,1000446,8,1000447,1000448,1000449,1000450,1000451,1000452,31,8,1000453,1000454,1000455,1000456,8,119,120,1000457,1000437,123,120,1000421,125,126,8,1000458,33,1000459,1000460,36,37,8,1000461,1000462,15,1000400,118,1000401,1000402,1000403,31,8,1000463,8,1000464,1000465,1000466,8,1000467,1000468,1000469,1000470,8,119,120,1000419,1000437,123,120,1000421,125,126,8,1000471,33,1000472,1000473,36,37,8,1000474,1000475,15,1000400,118,1000401,1000402,1000403,31,8,1000476,1000477,1000403,31,8,1000478,8,1000479,1000480,1000481,1000482,1000483,8,1000484,1000485,1000486,1000487,1000488,8,1000489,1000490,1000491,1000492,8,119,120,1000493,1000494,123,120,1000421,125,126,8,1000495,33,1000496,1000497,36,37,8,1000498,1000499,15,1000400,118,1000401,1000402,1000403,31,8,1000500,1000501,1000502,1000503,1000504,92,8,1000505,8,1000506,1000507,1000508,1000509,1000510,8,1000511,1000512,1000513,8,1000434,1000514,8,119,120,1000419,1000420,123,120,1000421,125,126,8,1000515,33,1000516,1000517,36,37,8,1000518,1000519,15,1000400,118,1000401,1000402,1000403,31,8,1000520,8,1000521,1000409,1000522,8,1000523,1000524,1000525,1000526,8,1000527,1000528,1000529,1000530,1000531,8,1000532,1000533,1000534,1000535,1000536,8,119,120,1000537,1000538,123,120,1000419,1000420,123,120,1000421,125,126,8,1000539,33,1000540,1000541,36,37,8,1000542,1000543,15,1000544,118,1000545,1000546,1000403,31,8,1000547,8,1000548,1000549,1000550,1000551,1000552,8,1000553,1000554,1000555,1000556,1000557,8,1000558,1000559,1000560,1000561,1000562,8,1000563,1000564,8,119,120,1000493,1000565,123,120,1000421,125,126,8,1000566,33,1000567,1000568,36,37,8,1000569,1000397,1000570,1000571,1000572,1000573,1000574,1000575,1000576,1000577,1000578,1000579,37,8,1000580,1000581,1000582,73,1000583,1000584,1000585,1000586,1000587,68,73,1000588,37,8,1000589,1000590,1000591,1000592,73,1000593,73,1000583,1000594,1000595,1000596,1000597,68,73,1000598,1000599,73,1000600,1000601,73,1000602,1000603,1000604,73,1000605,37,8,1000606,1000607,1000608,1000609,37,8,1000610,1000611,1000612,1000613,1000614,37,8,1000615,1000616,1000617,1000618,36,73,1000619,1000620,36,73,1000621,37]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}